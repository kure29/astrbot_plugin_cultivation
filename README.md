# 修仙RPG游戏插件 (AstrBot Plugin Cultivation)

[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)
[![Python Version](https://img.shields.io/badge/python-3.8+-blue.svg)](https://www.python.org/downloads/)
[![AstrBot](https://img.shields.io/badge/AstrBot-3.4+-green.svg)](https://github.com/AstrBotDevs/AstrBot)

基于AstrBot的史诗级修真RPG游戏插件，提供完整的修仙体验，包含境界修炼、探索冒险、战斗升级等丰富内容。采用模块化设计，支持LLM生成动态文案，为玩家带来沉浸式的修仙世界体验。

## ✨ 主要特性

### 🎮 核心游戏系统
- **角色创建系统** - 8种灵根类型，影响修炼效率和初始属性
- **境界修炼系统** - 完整的5大境界：凡人→炼气期→筑基期→金丹期→元婴期
- **天劫系统** - 筑基期以上需要渡劫，考验玩家运气和实力
- **探索冒险系统** - 8个特色地点，每个地点有独特的怪物和奖励
- **战斗系统** - 暴击、闪避、技能等多样化战斗机制
- **装备系统** - 武器、防具、饰品、法宝四大装备槽位

### 🚀 高级功能
- **模块化架构** - 清晰的代码结构，易于维护和扩展
- **LLM集成** - 支持动态生成修仙风格的游戏文案和描述
- **数据持久化** - SQLite数据库，重启不丢失数据
- **实时排行榜** - 等级排行榜和战力排行榜
- **每日签到** - 连续签到获得递增奖励
- **战力评估** - 综合战力计算和评级系统
- **随机事件** - 修炼顿悟、走火入魔等特殊事件

### 🎯 技术特点
- **异步处理** - 全面支持异步操作，性能优异
- **配置化管理** - 可视化配置界面，支持热更新
- **错误处理** - 完善的异常处理机制
- **扩展性** - 模块化设计便于添加新功能

## 📁 项目结构

```
astrbot_plugin_cultivation/
├── main.py                  # 🚪 主入口文件
├── metadata.yaml            # 📋 插件元数据
├── requirements.txt         # 📦 依赖文件
├── _conf_schema.json        # ⚙️ 配置模式文件
├── models/                  # 🏗️ 数据模型
│   ├── __init__.py
│   └── character.py         # 角色、装备、物品模型
├── systems/                 # 🎮 游戏系统
│   ├── __init__.py
│   ├── cultivation.py       # 修炼系统
│   ├── combat.py            # 战斗系统
│   ├── exploration.py       # 探索系统
│   ├── realm.py             # 境界系统
│   └── equipment.py         # 装备系统
├── database/                # 🗄️ 数据库相关
│   ├── __init__.py
│   └── db_manager.py        # 数据库管理
├── utils/                   # 🛠️ 工具函数
│   ├── __init__.py
│   ├── constants.py         # 常量定义
│   ├── helpers.py           # 辅助函数
│   └── llm_utils.py         # LLM相关工具
├── commands/                # 🎯 指令处理
│   ├── __init__.py
│   ├── basic.py             # 基础指令
│   ├── cultivation.py       # 修炼指令
│   └── exploration.py       # 探索指令
└── templates/               # 📝 LLM提示模板
    ├── __init__.py
    └── prompts.py           # 提示词模板
```

## 🚀 快速开始

### 环境要求

- **AstrBot** >= 3.4.0
- **Python** >= 3.8
- **SQLite3** (Python内置)

### 安装步骤

1. **获取插件代码**
   ```bash
   cd /path/to/astrbot/data/plugins/
   git clone https://github.com/kure29/astrbot_plugin_cultivation.git
   ```

2. **或手动安装**
   - 在插件目录创建 `astrbot_plugin_cultivation` 文件夹
   - 将所有文件复制到该文件夹中

3. **重启AstrBot**
   - 插件会自动创建数据库文件 `data/cultivation_game.db`
   - 看到"修仙RPG完整版插件初始化成功"表示安装成功

4. **配置插件**（可选）
   - 在AstrBot管理面板中找到本插件
   - 点击"配置"按钮调整游戏设置
   - 修改难度、经验倍数等参数

## 🎮 游戏指令

### 基础指令
| 指令 | 别名 | 说明 |
|------|------|------|
| `/开始游戏` | `/创建角色` `/开始修仙` | 创建角色，开始修仙之旅 |
| `/帮助` | `/指令` `/菜单` | 查看完整指令列表 |
| `/状态` | `/信息` `/属性` | 查看详细角色信息 |
| `/背包` | `/物品` `/道具` | 查看背包物品 |
| `/签到` | - | 每日签到获得奖励 |
| `/排行榜` | `/排名` `/榜单` | 查看等级排行榜 |
| `/战力` | `/评估` `/评级` | 查看战斗力评估 |

### 修炼系统
| 指令 | 别名 | 说明 |
|------|------|------|
| `/修炼` | `/练功` `/打坐` | 日常修炼，消耗真元获得经验 |
| `/突破` | `/晋级` `/进阶` | 尝试境界突破 |
| `/境界` | `/等级系统` `/修为` | 查看境界系统信息 |
| `/冥想` | - | 恢复真元的特殊修炼方式 |
| `/炼丹 [丹药名]` | - | 炼制丹药 |

### 探索冒险
| 指令 | 别名 | 说明 |
|------|------|------|
| `/地图` | `/区域` `/位置` | 查看当前区域和可达地点 |
| `/探索` | `/冒险` `/历练` | 探索当前区域 |
| `/前往 [地点]` | - | 移动到其他地点 |
| `/休息` | - | 恢复生命值和真元 |
| `/寻宝` | - | 花费金币进行寻宝 |

### 战斗系统
| 指令 | 别名 | 说明 |
|------|------|------|
| `/战斗` | `/攻击` `/出手` | 战斗中攻击敌人 |
| `/逃跑` | `/逃离` `/退避` | 战斗中尝试逃离 |

### 管理员指令
| 指令 | 说明 |
|------|------|
| `/重置数据 确认重置` | 重置所有游戏数据(管理员专用) |

## 🏗️ 系统详解

### 灵根系统
修仙之路从灵根开始，不同灵根决定了修炼天赋：

| 灵根 | 概率 | 修炼效率 | 特色 |
|------|------|----------|------|
| 天灵根 | 1.5% | 3.0倍 | 举世罕见，修炼神速 |
| 单灵根 | 5% | 2.0倍 | 万中无一，天资卓越 |
| 变异灵根 | 0.5% | 2.5倍 | 潜力无限，攻击力额外加成 |
| 双灵根 | 8% | 1.5倍 | 天资不凡 |
| 三灵根 | 10% | 1.2倍 | 资质良好 |
| 四灵根 | 20% | 1.0倍 | 普通资质 |
| 五行灵根 | 25% | 0.8倍 | 五行均衡 |
| 杂灵根 | 30% | 0.6倍 | 五行俱全但无一精通 |

### 境界体系
| 境界 | 等级范围 | 寿元 | 突破条件 | 特色 |
|------|----------|------|----------|------|
| 凡人 | 1-10级 | 70年 | 无 | 凡人之躯，初入修行 |
| 炼气期 | 11-25级 | 150年 | 10级 + 500金币 | 引气入体，踏入修仙之门 |
| 筑基期 | 26-40级 | 300年 | 25级 + 筑基丹 + 渡劫 | 筑就道基，百年寿元 |
| 金丹期 | 41-60级 | 500年 | 40级 + 结丹灵药 + 渡劫 | 金丹大成，寿五百载 |
| 元婴期 | 61-80级 | 1000年 | 60级 + 破婴丹 + 渡劫 | 元婴出窍，千年寿元 |

### 探索地点
游戏包含8个主要地点，构成完整的修仙世界：

1. **新手村** (1级) - 修仙者的起点，安全宁静
2. **青竹林** (5级) - 竹鼠、青蛇出没，适合新手历练
3. **草原** (8级) - 野狼成群的历练地
4. **寒潭** (15级) - 深潭寒气，妖狐栖息
5. **荒漠** (12级) - 山贼出没的危险之地
6. **深山** (20级) - 石傀儡、血虎横行
7. **古城** (25级) - 亡灵游荡的废弃古城
8. **仙城** (30级) - 修仙者聚集的繁华都市

## ⚙️ 配置说明

### 可配置参数

插件支持丰富的配置选项，可在AstrBot管理面板中调整：

#### 游戏基础设置
- **难度倍数**: 调整游戏整体难度
- **经验倍数**: 调整经验获得速度
- **金币倍数**: 调整金币获得速度
- **启用LLM描述**: 是否使用LLM生成动态文案

#### 战斗系统设置
- **遭遇怪物概率**: 探索时遭遇战斗的概率
- **掉落概率**: 击败敌人后的物品掉落率
- **基础暴击率**: 战斗中的暴击概率
- **基础逃跑成功率**: 战斗逃跑的成功率

#### 修炼系统设置
- **修炼冷却时间**: 两次修炼之间的间隔
- **启用突破系统**: 是否开启境界突破
- **启用渡劫系统**: 是否开启渡劫机制
- **基础突破成功率**: 突破时的成功概率

### 高级配置

#### 实验性功能
- **门派系统**: 允许玩家创建和加入门派
- **PVP系统**: 启用玩家对战功能
- **拍卖行**: 开启玩家间物品交易

## 🔧 开发指南

### 模块说明

#### 数据模型 (models/)
- `Character`: 角色主要类，包含所有角色属性和方法
- `Equipment`: 装备数据结构
- `InventoryItem`: 背包物品数据结构
- `CharacterStats`: 角色属性数据结构

#### 核心系统 (systems/)
- `CultivationSystem`: 处理修炼相关逻辑
- `CombatSystem`: 处理战斗相关逻辑
- `ExplorationSystem`: 处理探索和冒险
- `RealmSystem`: 处理境界突破和渡劫
- `EquipmentSystem`: 处理装备相关功能

#### 指令处理 (commands/)
- `BasicCommands`: 基础游戏指令
- `CultivationCommands`: 修炼相关指令
- `ExplorationCommands`: 探索相关指令

#### 工具模块 (utils/)
- `constants.py`: 游戏常量定义
- `llm_utils.py`: LLM集成工具
- `helpers.py`: 各种辅助函数

### 扩展开发

想要添加新功能？插件采用模块化设计，扩展简单：

1. **添加新境界**: 在 `constants.py` 的 `REALMS` 字典中添加
2. **添加新地点**: 在 `LOCATIONS` 字典中定义新地点信息
3. **添加新怪物**: 在 `MONSTERS` 字典中添加怪物数据
4. **添加新指令**: 在相应的指令处理类中使用 `@filter.command()` 装饰器

### 数据库结构

主要表结构：

- **characters**: 角色主要信息
- **combat_logs**: 战斗记录
- **global_data**: 全局游戏数据

## 🎭 LLM集成

### 动态文案生成

插件支持使用LLM生成各种游戏文案：

- **灵根觉醒描述**: 角色创建时的灵根觉醒文案
- **突破描述**: 境界突破时的动态描述
- **战斗描述**: 战斗过程的生动描述
- **探索描述**: 探索冒险的情景描述
- **修炼感悟**: 修炼过程的心境描述

### 回退机制

当LLM不可用时，插件会自动使用预设的文案，确保游戏正常运行。

## 🛠️ 故障排除

### 常见问题

**Q: 插件加载失败？**
A: 检查AstrBot版本是否≥3.4.0，确保Python版本≥3.8

**Q: 数据库创建失败？**
A: 确保插件目录有写入权限，检查data目录是否存在

**Q: 角色数据丢失？**
A: 检查 `data/cultivation_game.db` 文件是否存在，路径是否正确

**Q: 指令无响应？**
A: 确认插件已正确加载，检查AstrBot日志文件

**Q: LLM生成的文案不够好？**
A: 可以在配置中关闭LLM描述，使用预设文案，或调整LLM的系统提示词

### 调试模式

在配置中启用调试模式可以查看更详细的日志信息：

```json
{
  "admin_settings": {
    "debug_mode": true
  }
}
```

### 数据备份

建议定期备份数据库文件：

```bash
cp data/cultivation_game.db data/cultivation_backup_$(date +%Y%m%d).db
```

或启用自动备份功能：

```json
{
  "admin_settings": {
    "auto_backup_enabled": true,
    "backup_interval_hours": 24
  }
}
```

## 📊 性能优化

### 数据库优化
- 使用SQLite事务确保数据一致性
- JSON字段存储复杂数据结构
- 索引优化提升查询速度

### 内存管理
- 角色数据按需加载
- 智能缓存减少数据库查询
- 异步操作避免阻塞

### 并发处理
- 使用asyncio.Lock保证数据库操作安全
- 异步上下文管理器自动管理连接
- 错误隔离避免连锁故障

## 🤝 贡献指南

欢迎提交Issue和Pull Request来改进这个插件！

### 开发环境搭建

1. Fork项目仓库
2. 创建功能分支
3. 进行开发和测试
4. 提交Pull Request

### 代码规范

- 使用Python类型提示
- 遵循PEP 8代码风格
- 添加适当的注释和文档字符串
- 确保向后兼容性
- 编写单元测试

## 📝 更新日志

### v2.0.0 (当前版本)
- ✨ 全新模块化架构重构
- 🚀 集成LLM动态文案生成
- 💾 SQLite数据库持久化
- ⚡ 完整的境界突破和渡劫系统
- 🎮 优化战斗和探索系统
- 📊 新增排行榜和战力评估
- ⚙️ 可视化配置管理
- 🛠️ 完善的错误处理机制

### v1.0.0
- 🎯 基础修仙游戏功能
- 👤 角色创建和升级系统
- ⚔️ 简单战斗和探索机制

## 📄 许可证

本项目采用 [MIT License](LICENSE) 开源协议。

## 👨‍💻 作者信息

- **作者**: kure29
- **项目地址**: https://github.com/kure29/astrbot_plugin_cultivation
- **问题反馈**: https://github.com/kure29/astrbot_plugin_cultivation/issues
- **交流群**: 975206796

## 🙏 致谢

- 感谢 [AstrBot](https://github.com/AstrBotDevs/AstrBot) 项目提供的优秀框架
- 感谢社区用户的反馈和建议
- 感谢所有为项目做出贡献的开发者

---

**祝各位道友修仙顺利，早日飞升！** 🚀✨

> 如果这个插件对您有帮助，请考虑给项目点个 ⭐ Star，您的支持是我们持续改进的动力！
